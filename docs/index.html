<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>C·ªïng N·ªôp B√†i</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React UMD (global React/ReactDOM) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Firebase compat (global firebase) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <!-- Babel (JSX in browser) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Debug (t√πy ch·ªçn, gi√∫p hi·ªán l·ªói r√µ r√†ng) -->
  <script>
    window.onerror = function (msg, src, line, col, err) {
      document.body.innerHTML =
        "<pre style='white-space:pre-wrap;padding:12px;color:#b91c1c;font-family:monospace'>" +
        "window.onerror\\n" +
        "Message: " + msg + "\\n" +
        "Source: " + src + "\\n" +
        "Line: " + line + ":" + col + "\\n" +
        (err && err.stack ? ("\\n" + err.stack) : "") +
        "</pre>";
    };
    window.onunhandledrejection = function (e) {
      document.body.innerHTML =
        "<pre style='white-space:pre-wrap;padding:12px;color:#b91c1c;font-family:monospace'>" +
        "unhandledrejection\\n" +
        String(e && e.reason ? (e.reason.stack || e.reason.message || e.reason) : e) +
        "</pre>";
    };
  </script>
</head>

<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    /* ================= FIREBASE CONFIG ================= */
    const firebaseConfig = {
      apiKey: "AIzaSyCSz9VFOO5-fPYTEVdw3kSHBRykrUJYrYQ",
      authDomain: "nopbaitap-htd.firebaseapp.com",
      projectId: "nopbaitap-htd",
      storageBucket: "nopbaitap-htd.appspot.com",
      messagingSenderId: "245972751",
      appId: "1:245972751:web:94c86d0f88d412b883c87a"
    };

    // init firebase (compat)
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const serverTimestamp = firebase.firestore.FieldValue.serverTimestamp;

    /* ================= CONFIG APP ================= */
    const ADMIN_PASSWORD = "admin123"; // b·∫°n c√≥ th·ªÉ ƒë·ªïi

    // Collections
    const colStudents = () => db.collection("students");
    const colAssignments = () => db.collection("assignments");
    const colSubmissions = () => db.collection("submissions");

    // Emoji icons (thay cho lucide-react ƒë·ªÉ ·ªïn ƒë·ªãnh)
    const Icon = ({ children, className="" }) => (
      <span className={className} aria-hidden="true">{children}</span>
    );
    const UserIcon = (p) => <Icon {...p}>üë§</Icon>;
    const ShieldIcon = (p) => <Icon {...p}>üõ°Ô∏è</Icon>;
    const PlusIcon = (p) => <Icon {...p}>‚ûï</Icon>;
    const TrashIcon = (p) => <Icon {...p}>üóëÔ∏è</Icon>;
    const SheetIcon = (p) => <Icon {...p}>üìÑ</Icon>;
    const LinkIcon = (p) => <Icon {...p}>üîó</Icon>;
    const EditIcon = (p) => <Icon {...p}>‚úèÔ∏è</Icon>;
    const CheckIcon = (p) => <Icon {...p}>‚úÖ</Icon>;
    const SaveIcon = (p) => <Icon {...p}>üíæ</Icon>;
    const XIcon = (p) => <Icon {...p}>‚úñÔ∏è</Icon>;

    function App() {
      const [user, setUser] = React.useState(null);
      const [view, setView] = React.useState("home"); // home, student, admin-login, admin-dashboard

      // data
      const [students, setStudents] = React.useState([]);
      const [assignments, setAssignments] = React.useState([]);
      const [submissions, setSubmissions] = React.useState([]);

      // admin ui
      const [adminPassInput, setAdminPassInput] = React.useState("");
      const [isAdminAuthenticated, setIsAdminAuthenticated] = React.useState(false);
      const [newStudentName, setNewStudentName] = React.useState("");
      const [newAssignName, setNewAssignName] = React.useState("");
      const [newAssignDeadline, setNewAssignDeadline] = React.useState("");
      const [adminTab, setAdminTab] = React.useState("report"); // report, students, assignments

      // admin edit
      const [editingStudentId, setEditingStudentId] = React.useState(null);
      const [editingStudentName, setEditingStudentName] = React.useState("");

      const [editingAssignId, setEditingAssignId] = React.useState(null);
      const [editingAssignName, setEditingAssignName] = React.useState("");
      const [editingAssignDeadline, setEditingAssignDeadline] = React.useState("");

      // student ui
      const [selectedStudentId, setSelectedStudentId] = React.useState("");
      const [selectedAssignId, setSelectedAssignId] = React.useState("");
      const [linkInput, setLinkInput] = React.useState("");
      const [editingSubId, setEditingSubId] = React.useState(null);

      /* ============== AUTH INIT ============== */
      React.useEffect(() => {
        auth.signInAnonymously().catch(console.error);
        const unsub = auth.onAuthStateChanged((u) => setUser(u));
        return () => unsub();
      }, []);

      /* ============== REALTIME LISTENERS ============== */
      React.useEffect(() => {
        if (!user) return;

        const unsubStudents = colStudents()
          .orderBy("name")
          .onSnapshot(
            (snap) => setStudents(snap.docs.map(d => ({ id: d.id, ...d.data() }))),
            (err) => console.error(err)
          );

        const unsubAssignments = colAssignments()
          .orderBy("createdAt")
          .onSnapshot(
            (snap) => setAssignments(snap.docs.map(d => ({ id: d.id, ...d.data() }))),
            (err) => console.error(err)
          );

        const unsubSubmissions = colSubmissions()
          .orderBy("timestamp", "desc")
          .onSnapshot(
            (snap) => setSubmissions(snap.docs.map(d => ({ id: d.id, ...d.data() }))),
            (err) => console.error(err)
          );

        return () => {
          unsubStudents();
          unsubAssignments();
          unsubSubmissions();
        };
      }, [user]);

      /* ============== HELPERS ============== */
      const getStudentName = (id) => students.find(s => s.id === id)?.name || "Unknown";
      const getAssignName = (id) => assignments.find(a => a.id === id)?.title || "Unknown";
      const getAssignment = (id) => assignments.find(a => a.id === id);
      const getAssignDeadline = (id) => getAssignment(id)?.deadline || "";

      const toISODateLocal = (dateObj = new Date()) => {
        const y = dateObj.getFullYear();
        const m = String(dateObj.getMonth() + 1).padStart(2, "0");
        const d = String(dateObj.getDate()).padStart(2, "0");
        return `${y}-${m}-${d}`;
      };

      const formatVNDate = (iso) => {
        if (!iso) return "";
        const parts = iso.split("-");
        if (parts.length !== 3) return iso;
        return `${parts[2]}/${parts[1]}/${parts[0]}`;
      };

      const isOnTime = (submitDate, deadline) => {
        if (!submitDate || !deadline) return false;
        return submitDate <= deadline;
      };

      const mySubmissions = React.useMemo(() => {
        if (!selectedStudentId) return [];
        return submissions.filter(s => s.studentId === selectedStudentId);
      }, [submissions, selectedStudentId]);

      /* ============== ADMIN ============== */
      const handleAdminLogin = (e) => {
        e.preventDefault();
        if (adminPassInput === ADMIN_PASSWORD) {
          setIsAdminAuthenticated(true);
          setView("admin-dashboard");
          setAdminPassInput("");
        } else {
          alert("Sai m·∫≠t kh·∫©u!");
        }
      };

      const addStudent = async () => {
        if (!newStudentName.trim()) return;
        try {
          await colStudents().add({ name: newStudentName.trim(), createdAt: serverTimestamp() });
          setNewStudentName("");
        } catch (e) { console.error(e); alert("L·ªói th√™m h·ªçc vi√™n"); }
      };

      const deleteStudent = async (id) => {
        if (!confirm("X√≥a h·ªçc vi√™n n√†y? C√°c b√†i n·ªôp li√™n quan v·∫´n c√≤n nh∆∞ng s·∫Ω m·∫•t li√™n k·∫øt.")) return;
        try {
          await colStudents().doc(id).delete();
        } catch (e) { console.error(e); alert("L·ªói x√≥a h·ªçc vi√™n"); }
      };

      const startEditStudent = (stu) => {
        setEditingStudentId(stu.id);
        setEditingStudentName(stu.name || "");
      };
      const cancelEditStudent = () => {
        setEditingStudentId(null);
        setEditingStudentName("");
      };
      const saveEditStudent = async () => {
        if (!editingStudentId) return;
        if (!editingStudentName.trim()) { alert("T√™n kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng"); return; }
        try {
          await colStudents().doc(editingStudentId).update({ name: editingStudentName.trim() });
          cancelEditStudent();
        } catch (e) { console.error(e); alert("L·ªói c·∫≠p nh·∫≠t h·ªçc vi√™n"); }
      };

      const addAssignment = async () => {
        if (!newAssignName.trim()) return;
        try {
          await colAssignments().add({
            title: newAssignName.trim(),
            deadline: newAssignDeadline || "",
            createdAt: serverTimestamp()
          });
          setNewAssignName("");
          setNewAssignDeadline("");
        } catch (e) { console.error(e); alert("L·ªói th√™m b√†i t·∫≠p"); }
      };

      const deleteAssignment = async (id) => {
        if (!confirm("X√≥a b√†i t·∫≠p n√†y?")) return;
        try {
          await colAssignments().doc(id).delete();
        } catch (e) { console.error(e); alert("L·ªói x√≥a b√†i t·∫≠p"); }
      };

      const startEditAssignment = (a) => {
        setEditingAssignId(a.id);
        setEditingAssignName(a.title || "");
        setEditingAssignDeadline(a.deadline || "");
      };
      const cancelEditAssignment = () => {
        setEditingAssignId(null);
        setEditingAssignName("");
        setEditingAssignDeadline("");
      };
      const saveEditAssignment = async () => {
        if (!editingAssignId) return;
        if (!editingAssignName.trim()) { alert("T√™n b√†i t·∫≠p kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng"); return; }
        try {
          await colAssignments().doc(editingAssignId).update({
            title: editingAssignName.trim(),
            deadline: editingAssignDeadline || ""
          });
          cancelEditAssignment();
        } catch (e) { console.error(e); alert("L·ªói c·∫≠p nh·∫≠t b√†i t·∫≠p"); }
      };

      const exportToCSV = () => {
        const headers = ["H·ªç v√† T√™n", ...assignments.map(a => a.title)];

        const rows = students.map(stu => {
          const rowData = [stu.name];
          assignments.forEach(assign => {
            const sub = submissions.find(s => s.studentId === stu.id && s.assignmentId === assign.id);
            rowData.push(sub ? sub.link : "");
          });
          return rowData.map(cell => `"${String(cell ?? "").replaceAll('"', '""')}"`).join(",");
        });

        const csvContent = "\uFEFF" + headers.map(h => `"${h.replaceAll('"', '""')}"`).join(",") + "\n" + rows.join("\n");
        const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = `Bao_cao_nop_bai_${new Date().toISOString().slice(0,10)}.csv`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      };

      /* ============== STUDENT ============== */
      const handleSubmitWork = async (e) => {
        e.preventDefault();

        if (!selectedStudentId || !selectedAssignId || !linkInput) {
          alert("Vui l√≤ng ch·ªçn ƒë·∫ßy ƒë·ªß th√¥ng tin v√† d√°n link!");
          return;
        }

        const existingSub = submissions.find(s =>
          s.studentId === selectedStudentId && s.assignmentId === selectedAssignId
        );

        const todayISO = toISODateLocal(new Date());

        try {
          if (editingSubId) {
            await colSubmissions().doc(editingSubId).update({
              link: linkInput,
              submitDate: todayISO,
              timestamp: serverTimestamp()
            });
            setEditingSubId(null);
            alert("C·∫≠p nh·∫≠t b√†i n·ªôp th√†nh c√¥ng!");
          } else if (existingSub) {
            if (confirm("B·∫°n ƒë√£ n·ªôp b√†i n√†y r·ªìi. C·∫≠p nh·∫≠t link m·ªõi?")) {
              await colSubmissions().doc(existingSub.id).update({
                link: linkInput,
                submitDate: todayISO,
                timestamp: serverTimestamp()
              });
              alert("C·∫≠p nh·∫≠t th√†nh c√¥ng!");
            }
          } else {
            await colSubmissions().add({
              studentId: selectedStudentId,
              assignmentId: selectedAssignId,
              link: linkInput,
              submitDate: todayISO,
              timestamp: serverTimestamp()
            });
            alert("N·ªôp b√†i th√†nh c√¥ng!");
          }
          setLinkInput("");
        } catch (e) {
          console.error(e);
          alert("C√≥ l·ªói x·∫£y ra khi n·ªôp b√†i.");
        }
      };

      const handleDeleteSubmission = async (subId) => {
        if (!confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a b√†i n·ªôp n√†y?")) return;
        try {
          await colSubmissions().doc(subId).delete();
        } catch (e) { console.error(e); alert("L·ªói x√≥a b√†i n·ªôp"); }
      };

      const handleEditRequest = (sub) => {
        setSelectedAssignId(sub.assignmentId);
        setLinkInput(sub.link);
        setEditingSubId(sub.id);
        window.scrollTo({ top: 0, behavior: "smooth" });
      };

      /* ============== RENDER ============== */
      if (!user) {
        return (
          <div className="min-h-screen flex items-center justify-center text-gray-500">
            ƒêang t·∫£i k·∫øt n·ªëi...
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gray-100 font-sans text-gray-800">
          <header className="bg-blue-600 text-white p-4 shadow-md sticky top-0 z-50">
            <div className="max-w-5xl mx-auto flex justify-between items-center">
              <h1 className="text-xl font-bold flex items-center gap-2">
                <CheckIcon className="w-6 h-6" /> C·ªïng N·ªôp B√†i
              </h1>
              <div className="flex gap-2">
                {view !== "home" && (
                  <button
                    onClick={() => {
                      setView("home");
                      setIsAdminAuthenticated(false);
                      cancelEditStudent();
                      cancelEditAssignment();
                    }}
                    className="text-sm bg-blue-700 hover:bg-blue-800 px-3 py-1 rounded transition"
                  >
                    Tho√°t
                  </button>
                )}
              </div>
            </div>
          </header>

          <main className="max-w-5xl mx-auto p-4">
            {view === "home" && (
              <div className="flex flex-col md:flex-row gap-6 mt-10 justify-center items-center">
                <div
                  onClick={() => setView("student")}
                  className="w-full md:w-64 h-48 bg-white rounded-xl shadow-lg hover:shadow-xl cursor-pointer flex flex-col items-center justify-center gap-4 transition transform hover:-translate-y-1 border border-gray-200"
                >
                  <UserIcon className="text-4xl" />
                  <span className="text-xl font-semibold text-gray-700">T√¥i l√† H·ªçc Vi√™n</span>
                </div>

                <div
                  onClick={() => setView("admin-login")}
                  className="w-full md:w-64 h-48 bg-white rounded-xl shadow-lg hover:shadow-xl cursor-pointer flex flex-col items-center justify-center gap-4 transition transform hover:-translate-y-1 border border-gray-200"
                >
                  <ShieldIcon className="text-4xl" />
                  <span className="text-xl font-semibold text-gray-700">T√¥i l√† Admin</span>
                </div>
              </div>
            )}

            {view === "admin-login" && (
              <div className="max-w-md mx-auto mt-20 bg-white p-8 rounded-xl shadow-lg">
                <h2 className="text-2xl font-bold mb-6 text-center text-gray-800">ƒêƒÉng nh·∫≠p Qu·∫£n tr·ªã</h2>
                <form onSubmit={handleAdminLogin} className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium mb-1">M·∫≠t kh·∫©u</label>
                    <input
                      type="password"
                      value={adminPassInput}
                      onChange={(e) => setAdminPassInput(e.target.value)}
                      className="w-full border p-2 rounded focus:ring-2 focus:ring-blue-500 outline-none"
                      placeholder="Nh·∫≠p m·∫≠t kh·∫©u..."
                    />
                  </div>
                  <button type="submit" className="w-full bg-blue-600 text-white py-2 rounded font-semibold hover:bg-blue-700 transition">
                    Truy c·∫≠p
                  </button>
                </form>
              </div>
            )}

            {/* STUDENT */}
            {view === "student" && (
              <div className="space-y-6">
                <div className="bg-white p-6 rounded-xl shadow-md border-t-4 border-green-500">
                  <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                    <EditIcon /> N·ªôp b√†i t·∫≠p
                  </h2>

                  <form onSubmit={handleSubmitWork} className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">1. T√™n c·ªßa b·∫°n</label>
                      <select
                        value={selectedStudentId}
                        onChange={(e) => {
                          setSelectedStudentId(e.target.value);
                          setEditingSubId(null);
                          setLinkInput("");
                          setSelectedAssignId("");
                        }}
                        className="w-full p-2 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-green-500 outline-none"
                        required
                      >
                        <option value="">-- Ch·ªçn t√™n h·ªçc vi√™n --</option>
                        {students.map(s => (
                          <option key={s.id} value={s.id}>{s.name}</option>
                        ))}
                      </select>
                    </div>

                    {selectedStudentId && (
                      <>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">2. Ch·ªçn b√†i t·∫≠p</label>
                          <select
                            value={selectedAssignId}
                            onChange={(e) => setSelectedAssignId(e.target.value)}
                            className="w-full p-2 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-green-500 outline-none"
                            required
                          >
                            <option value="">-- Ch·ªçn b√†i t·∫≠p --</option>
                            {assignments.map(a => (
                              <option key={a.id} value={a.id}>
                                {a.title}{a.deadline ? ` (Deadline: ${formatVNDate(a.deadline)})` : ""}
                              </option>
                            ))}
                          </select>
                        </div>

                        {selectedAssignId && (
                          <div className="text-sm text-gray-600">
                            Deadline c·ªßa b√†i n√†y:{" "}
                            <span className="font-semibold text-gray-800">
                              {getAssignDeadline(selectedAssignId) ? formatVNDate(getAssignDeadline(selectedAssignId)) : "Ch∆∞a thi·∫øt l·∫≠p"}
                            </span>
                          </div>
                        )}

                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">3. Link b√†i n·ªôp</label>
                          <input
                            type="url"
                            value={linkInput}
                            onChange={(e) => setLinkInput(e.target.value)}
                            placeholder="https://..."
                            className="w-full p-2 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-green-500 outline-none"
                            required
                          />
                        </div>

                        <button
                          type="submit"
                          className={`w-full py-3 rounded-lg font-bold text-white transition shadow-md ${
                            editingSubId ? "bg-orange-500 hover:bg-orange-600" : "bg-green-600 hover:bg-green-700"
                          }`}
                        >
                          {editingSubId ? "C·∫≠p nh·∫≠t b√†i n·ªôp" : "G·ª≠i b√†i n·ªôp"}
                        </button>

                        {editingSubId && (
                          <button
                            type="button"
                            onClick={() => { setEditingSubId(null); setLinkInput(""); }}
                            className="w-full mt-2 py-2 text-gray-600 hover:bg-gray-100 rounded-lg"
                          >
                            H·ªßy ch·ªânh s·ª≠a
                          </button>
                        )}
                      </>
                    )}
                  </form>
                </div>

                {selectedStudentId && (
                  <div className="bg-white p-6 rounded-xl shadow-md">
                    <h3 className="text-lg font-bold mb-4 text-gray-700">
                      L·ªãch s·ª≠ n·ªôp b√†i c·ªßa: {getStudentName(selectedStudentId)}
                    </h3>

                    {mySubmissions.length === 0 ? (
                      <p className="text-gray-500 italic">Ch∆∞a c√≥ b√†i n·ªôp n√†o.</p>
                    ) : (
                      <div className="overflow-x-auto">
                        <table className="w-full text-left border-collapse">
                          <thead>
                            <tr className="border-b bg-gray-50">
                              <th className="p-3 text-sm font-semibold text-gray-600">B√†i t·∫≠p</th>
                              <th className="p-3 text-sm font-semibold text-gray-600">Link</th>
                              <th className="p-3 text-sm font-semibold text-gray-600">Th·ªùi gian</th>
                              <th className="p-3 text-sm font-semibold text-gray-600">Ng√†y n·ªôp</th>
                              <th className="p-3 text-sm font-semibold text-gray-600">Deadline</th>
                              <th className="p-3 text-sm font-semibold text-gray-600 text-right">H√†nh ƒë·ªông</th>
                            </tr>
                          </thead>
                          <tbody>
                            {mySubmissions.map(sub => {
                              const dl = getAssignDeadline(sub.assignmentId);
                              const ontime = isOnTime(sub.submitDate, dl);

                              return (
                                <tr key={sub.id} className="border-b last:border-0 hover:bg-gray-50">
                                  <td className="p-3 font-medium text-gray-800">
                                    <div>{getAssignName(sub.assignmentId)}</div>
                                    {ontime && (
                                      <div className="mt-1 text-sm text-green-600 font-semibold">
                                        Ch√∫c m·ª´ng b·∫°n ƒë√£ ho√†n th√†nh b√†i h·ªçc ƒë√∫ng h·∫°n
                                      </div>
                                    )}
                                  </td>

                                  <td className="p-3">
                                    <a
                                      href={sub.link}
                                      target="_blank"
                                      rel="noreferrer"
                                      className="text-blue-600 hover:underline flex items-center gap-1 max-w-[160px] truncate"
                                    >
                                      Xem Link <LinkIcon />
                                    </a>
                                  </td>

                                  <td className="p-3 text-sm text-gray-500">
                                    {sub.timestamp?.toDate ? sub.timestamp.toDate().toLocaleString("vi-VN") : "V·ª´a xong"}
                                  </td>

                                  <td className="p-3 text-sm text-gray-700">
                                    {sub.submitDate ? formatVNDate(sub.submitDate) : "-"}
                                  </td>

                                  <td className="p-3 text-sm text-gray-700">
                                    {dl ? formatVNDate(dl) : "-"}
                                  </td>

                                  <td className="p-3 text-right space-x-2">
                                    <button
                                      onClick={() => handleEditRequest(sub)}
                                      className="text-orange-500 hover:text-orange-700 text-sm font-medium"
                                    >
                                      S·ª≠a
                                    </button>
                                    <button
                                      onClick={() => handleDeleteSubmission(sub.id)}
                                      className="text-red-500 hover:text-red-700 text-sm font-medium"
                                    >
                                      X√≥a
                                    </button>
                                  </td>
                                </tr>
                              );
                            })}
                          </tbody>
                        </table>
                      </div>
                    )}
                  </div>
                )}
              </div>
            )}

            {/* ADMIN DASHBOARD */}
            {view === "admin-dashboard" && isAdminAuthenticated && (
              <div className="space-y-6">
                <div className="flex flex-wrap gap-2 border-b pb-2">
                  <button
                    onClick={() => { setAdminTab("report"); cancelEditStudent(); cancelEditAssignment(); }}
                    className={`px-4 py-2 rounded-lg font-medium transition ${
                      adminTab === "report" ? "bg-blue-600 text-white" : "bg-white text-gray-600 hover:bg-gray-100"
                    }`}
                  >
                    B√°o c√°o T·ªïng quan
                  </button>
                  <button
                    onClick={() => { setAdminTab("students"); cancelEditAssignment(); }}
                    className={`px-4 py-2 rounded-lg font-medium transition ${
                      adminTab === "students" ? "bg-blue-600 text-white" : "bg-white text-gray-600 hover:bg-gray-100"
                    }`}
                  >
                    QL H·ªçc vi√™n
                  </button>
                  <button
                    onClick={() => { setAdminTab("assignments"); cancelEditStudent(); }}
                    className={`px-4 py-2 rounded-lg font-medium transition ${
                      adminTab === "assignments" ? "bg-blue-600 text-white" : "bg-white text-gray-600 hover:bg-gray-100"
                    }`}
                  >
                    QL B√†i t·∫≠p
                  </button>
                </div>

                {adminTab === "report" && (
                  <div className="bg-white p-4 rounded-xl shadow-md overflow-hidden">
                    <div className="flex justify-between items-center mb-4">
                      <h3 className="text-lg font-bold text-gray-800">Ti·∫øn ƒë·ªô n·ªôp b√†i</h3>
                      <button
                        onClick={exportToCSV}
                        className="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition shadow-sm"
                      >
                        <SheetIcon /> Xu·∫•t Excel
                      </button>
                    </div>

                    <div className="overflow-x-auto border rounded-lg">
                      <table className="w-full text-center border-collapse text-sm">
                        <thead>
                          <tr className="bg-gray-100 text-gray-700">
                            <th className="p-3 border-r border-b min-w-[180px] text-left sticky left-0 bg-gray-100 z-10">
                              H·ªå T√äN H·ªåC VI√äN
                            </th>
                            {assignments.map(a => (
                              <th key={a.id} className="p-3 border-b min-w-[120px] font-semibold">
                                <div>{a.title}</div>
                                {a.deadline && (
                                  <div className="mt-1 text-xs text-gray-500">
                                    DL: {formatVNDate(a.deadline)}
                                  </div>
                                )}
                              </th>
                            ))}
                          </tr>
                        </thead>
                        <tbody>
                          {students.map((stu, idx) => (
                            <tr key={stu.id} className="hover:bg-gray-50">
                              <td className="p-3 border-r border-b text-left font-medium sticky left-0 bg-white z-10">
                                {idx + 1}. {stu.name}
                              </td>
                              {assignments.map(assign => {
                                const sub = submissions.find(s => s.studentId === stu.id && s.assignmentId === assign.id);
                                return (
                                  <td key={assign.id} className="p-3 border-b">
                                    {sub ? (
                                      <a
                                        href={sub.link}
                                        target="_blank"
                                        rel="noreferrer"
                                        className="inline-block text-green-600 font-bold text-lg hover:scale-125 transition transform"
                                        title="ƒê√£ n·ªôp"
                                      >
                                        ‚úì
                                      </a>
                                    ) : (
                                      <span className="text-gray-300">-</span>
                                    )}
                                  </td>
                                );
                              })}
                            </tr>
                          ))}
                          {students.length === 0 && (
                            <tr>
                              <td colSpan={assignments.length + 1} className="p-4 text-gray-400">Ch∆∞a c√≥ d·ªØ li·ªáu h·ªçc vi√™n</td>
                            </tr>
                          )}
                        </tbody>
                      </table>
                    </div>
                  </div>
                )}

                {adminTab === "students" && (
                  <div className="bg-white p-6 rounded-xl shadow-md">
                    <h3 className="font-bold mb-4">Danh s√°ch H·ªçc Vi√™n ({students.length})</h3>

                    <form onSubmit={(e) => { e.preventDefault(); addStudent(); }} className="flex gap-2 mb-6">
                      <input
                        type="text"
                        value={newStudentName}
                        onChange={(e) => setNewStudentName(e.target.value)}
                        placeholder="Nh·∫≠p t√™n h·ªçc vi√™n m·ªõi..."
                        className="flex-1 border p-2 rounded focus:ring-2 focus:ring-blue-500 outline-none"
                      />
                      <button type="submit" className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center gap-1">
                        <PlusIcon /> Th√™m
                      </button>
                    </form>

                    <div className="grid gap-2 grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
                      {students.map(s => {
                        const isEditing = editingStudentId === s.id;

                        return (
                          <div key={s.id} className="flex justify-between items-center p-3 bg-gray-50 rounded border group hover:border-blue-300 gap-2">
                            {!isEditing ? (
                              <span className="font-medium flex-1">{s.name}</span>
                            ) : (
                              <form onSubmit={(e) => { e.preventDefault(); saveEditStudent(); }} className="flex-1 flex gap-2">
                                <input
                                  type="text"
                                  value={editingStudentName}
                                  onChange={(e) => setEditingStudentName(e.target.value)}
                                  className="w-full border p-2 rounded focus:ring-2 focus:ring-blue-500 outline-none"
                                  autoFocus
                                />
                                <button type="submit" className="text-green-600 hover:text-green-800" title="L∆∞u"><SaveIcon /></button>
                                <button type="button" onClick={cancelEditStudent} className="text-gray-500 hover:text-gray-700" title="H·ªßy"><XIcon /></button>
                              </form>
                            )}

                            {!isEditing && (
                              <div className="flex items-center gap-2">
                                <button onClick={() => startEditStudent(s)} className="text-gray-400 hover:text-orange-600 transition" title="S·ª≠a"><EditIcon /></button>
                                <button onClick={() => deleteStudent(s.id)} className="text-gray-400 hover:text-red-500 transition" title="X√≥a"><TrashIcon /></button>
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                )}

                {adminTab === "assignments" && (
                  <div className="bg-white p-6 rounded-xl shadow-md">
                    <h3 className="font-bold mb-4">Danh s√°ch B√†i T·∫≠p ({assignments.length})</h3>

                    <form onSubmit={(e) => { e.preventDefault(); addAssignment(); }} className="flex gap-2 mb-6 flex-col md:flex-row">
                      <input
                        type="text"
                        value={newAssignName}
                        onChange={(e) => setNewAssignName(e.target.value)}
                        placeholder="VD: B√†i t·∫≠p 1..."
                        className="flex-1 border p-2 rounded focus:ring-2 focus:ring-blue-500 outline-none"
                      />

                      <input
                        type="date"
                        value={newAssignDeadline}
                        onChange={(e) => setNewAssignDeadline(e.target.value)}
                        className="border p-2 rounded focus:ring-2 focus:ring-blue-500 outline-none"
                        title="Deadline"
                      />

                      <button type="submit" className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center gap-1">
                        <PlusIcon /> Th√™m
                      </button>
                    </form>

                    <ul className="space-y-2">
                      {assignments.map((a, idx) => {
                        const isEditing = editingAssignId === a.id;

                        return (
                          <li key={a.id} className="flex justify-between items-center p-3 bg-gray-50 rounded border gap-2">
                            {!isEditing ? (
                              <span className="font-medium flex-1">
                                <span className="text-blue-600 font-bold mr-2">#{idx + 1}</span>
                                {a.title}
                                {a.deadline ? (
                                  <span className="ml-2 text-xs text-gray-500">(Deadline: {formatVNDate(a.deadline)})</span>
                                ) : (
                                  <span className="ml-2 text-xs text-gray-400">(Ch∆∞a c√≥ deadline)</span>
                                )}
                              </span>
                            ) : (
                              <form onSubmit={(e) => { e.preventDefault(); saveEditAssignment(); }} className="flex-1 flex flex-col md:flex-row gap-2">
                                <input
                                  type="text"
                                  value={editingAssignName}
                                  onChange={(e) => setEditingAssignName(e.target.value)}
                                  className="flex-1 border p-2 rounded focus:ring-2 focus:ring-blue-500 outline-none"
                                  autoFocus
                                />
                                <input
                                  type="date"
                                  value={editingAssignDeadline}
                                  onChange={(e) => setEditingAssignDeadline(e.target.value)}
                                  className="border p-2 rounded focus:ring-2 focus:ring-blue-500 outline-none"
                                  title="Deadline"
                                />
                                <div className="flex gap-2 items-center">
                                  <button type="submit" className="text-green-600 hover:text-green-800" title="L∆∞u"><SaveIcon /></button>
                                  <button type="button" onClick={cancelEditAssignment} className="text-gray-500 hover:text-gray-700" title="H·ªßy"><XIcon /></button>
                                </div>
                              </form>
                            )}

                            {!isEditing && (
                              <div className="flex items-center gap-2">
                                <button onClick={() => startEditAssignment(a)} className="text-gray-400 hover:text-orange-600 transition" title="S·ª≠a"><EditIcon /></button>
                                <button onClick={() => deleteAssignment(a.id)} className="text-gray-400 hover:text-red-500 transition" title="X√≥a"><TrashIcon /></button>
                              </div>
                            )}
                          </li>
                        );
                      })}
                    </ul>
                  </div>
                )}
              </div>
            )}
          </main>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
